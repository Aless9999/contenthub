<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Home Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f7f7f7;
            margin: 0;
            padding: 0;
        }
        .container {
            display: flex;
            max-width: 1200px;
            margin: 20px auto;
            gap: 20px;
        }
        .post-list {
            width: 25%;
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            height: 80vh;
            overflow-y: auto;
        }
        .post-content {
            width: 75%;
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            min-height: 80vh;
        }
        .post-item {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            cursor: pointer;
        }
        .post-item:hover {
            background-color: #f0f0f0;
        }
        .post-images img {
            width: 120px;
            margin: 5px;
            border-radius: 4px;
        }
        .comments {
            margin-top: 15px;
            padding-left: 10px;
            border-left: 2px solid #ccc;
        }
        .comments p {
            margin: 5px 0;
        }
        form {
            margin-top: 10px;
        }
        input[type="text"], input[type="file"] {
            width: 90%;
            padding: 5px;
            margin-bottom: 5px;
        }
        button {
            padding: 5px 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<h1 style="text-align:center;">Welcome, <span th:text="${user.username}">User</span>!</h1>

<div class="container">
    <!-- Список постов -->
    <div class="post-list">
        <h3>Your Posts</h3>
        <div th:each="post : ${posts}" class="post-item"
             th:text="${post.title}"
             th:onclick="'showPost(' + ${post.id} + ')'"></div>
    </div>

    <!-- Выбранный пост -->
    <div class="post-content" id="selectedPost">
        <p>Select a post to view details</p>
    </div>
</div>

<!-- Форма создания нового поста -->
<div class="container">
    <div style="width:100%; background-color:#fff; padding:15px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1);">
        <h3>Create New Post</h3>
        <form th:action="@{/posts/save}" method="post" enctype="multipart/form-data">
            <input type="text" name="title" placeholder="Title" required/>
            <input type="text" name="caption" placeholder="Caption"/>
            <input type="text" name="location" placeholder="Location"/>
            <input type="file" name="image"/>
            <button type="submit">Post</button>
        </form>
    </div>
</div>

<script th:inline="javascript">
    /*<![CDATA[*/
    const posts = /*[[${posts}]]*/ [];

    function showPost(postId) {
        const post = posts.find(p => p.id == postId);
        const postDiv = document.getElementById('selectedPost');
        postDiv.innerHTML = '';

        if (!post) return;

        let html = '<h2>' + post.title + '</h2>';
        html += '<p>' + post.caption + '</p>';
        html += '<p>Location: ' + (post.location || '') + '</p>';

        if (post.images && post.images.length > 0) {
            html += '<div class="post-images">';
            post.images.forEach(img => {
                html += '<img src="/images/' + img.id + '" alt="Image"/>';
            });
            html += '</div>';
        }

        html += '<div class="comments"><h4>Comments</h4>';
        if (post.comments && post.comments.length > 0) {
            post.comments.forEach(c => {
                html += '<p><b>' + c.username + '</b>: ' + c.message + '</p>';
            });
        } else {
            html += '<p>No comments yet</p>';
        }
        html += '</div>';

        // Форма добавления комментария
        html += '<form method="post" action="/posts/' + post.id + '/comment">';
        html += '<input type="text" name="message" placeholder="Add a comment"/>';
        html += '<button type="submit">Comment</button>';
        html += '</form>';

        // Форма добавления изображения
        html += '<form method="post" action="/posts/' + post.id + '/saveimage" enctype="multipart/form-data">';
        html += '<input type="file" name="image"/>';
        html += '<button type="submit">Add Image</button>';
        html += '</form>';

        postDiv.innerHTML = html;
    }
    /*]]>*/
</script>
</body>
</html>
